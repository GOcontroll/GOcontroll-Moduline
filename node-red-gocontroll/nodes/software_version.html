<script type="text/javascript">
    RED.nodes.registerType('Software',{
        category: 'GOcontroll',
        color: '#f76d11',
        defaults: {
		payload : {value:""},
        },
        inputs:0,
        outputs:0,
        icon: "font-awesome/fa-cogs",
        label: function() {
            return this.name||"Click to check latest version";
        },
		button: {
            enabled: function() {
                return !this.changed
            },
            onclick: function() {
                if (this.changed) {
                    return RED.notify(RED._("notification.warning", {message:RED._("notification.warnings.undeployedChanges")}),"warning");
                }
				
				var payload = "Rickert";// this.payload;
				
				 $.getJSON('softwareVersion',function(data) {
				 
					 if(data.machineState == 0)
					 {
					 RED.notify(node._("Request latest version on GitHub"),{type:"success",id:"update"});
					 }
					 else if(data.machineState == 1)
					 {
					 RED.notify(node._("New software available! Click to update."),{type:"success",id:"update"});
					 this.name = "Click to update controller.";
					 }
					 else if(data.machineState == 2)
					 {
					 RED.notify(node._("GOcontroll Moduline III is up to date!"),{type:"success",id:"update"});
					 this.name = "GOcontroll node software";
					 }
		
				 });
              //  var payload = this.payload;
              //  if ((this.payloadType === 'flow') ||
              //     (this.payloadType === 'global')) {
              //      var key = RED.utils.parseContextKey(payload);
              //      payload = this.payloadType+"."+key.key;
              //  }
                var label = this._def.label.call(this);
                //if (label.length > 30) {
                //    label = label.substring(0,50)+"...";
                //}
                label = label.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
                var node = this;
                $.ajax({
                    url: "inject/"+this.id,
                    type:"POST",
                    success: function(resp) {
                       // RED.notify(node._("Request software update"+payload,{label:label}),{type:"success",id:"update"});
					//	 RED.notify(node._("Request software update"+payload),{type:"success",id:"update"});
                    },
                    error: function(jqXHR,textStatus,errorThrown) {
                    }
                });
            }
		}
    });
</script>

<script type="text/x-red" data-template-name="Software">

    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
	
</script>


<script type="text/x-red" data-help-name="Software">
<p>The settings block configures the basic settings of the GOcontroll Moduline 3 controller.</p>
<p>&nbsp;</p>
<h2>Wireless LAN Acces Point credentials:</h2>
<p><em>SSID:</em></p>
<p>The name of the wireless LAN acces point network.</p>
<p><em>Password:</em></p>
<p>The credentials of the wireless LAN acces point network.</p>
<p>&nbsp;</p>
<h2>CAN speed settings:</h2>
<p>Here you can select the speed of CAN 1 and CAN 2. Changing these parameters, needs a reboot of the controller after deployment of the new parameters.</p>
</script>
